(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(4949)}])},4949:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return eM}});var t=r(5893),l=r(7294),a=r(3321),i=r(5582),c=r(6242),s=r(4267),o=r(2023),d=r(7957),u=r(9008),h=r.n(u),p=r(2293),x=r(155),g=r(5861),v=r(8298),f=r(4776);let m=e=>{let n=(0,v.Z)();return(0,t.jsx)(f.Z,{appear:!1,direction:"down",in:!n,children:e.children})},j=()=>(0,t.jsxs)(h(),{children:[(0,t.jsx)("title",{children:"FF Image Clip"}),(0,t.jsx)("meta",{name:"description",content:"ff14のスクリーンショットをお手軽に加工するためのWebサービス"}),(0,t.jsx)("link",{rel:"icon",href:"/logo.svg",type:"image/svg+xml",sizes:"any"})]}),C=()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m,{children:(0,t.jsx)(p.Z,{children:(0,t.jsx)(x.Z,{style:{display:"flex",justifyContent:"center"},children:(0,t.jsx)(g.Z,{variant:"h5",component:"div",children:"FF Image Clip"})})})}),(0,t.jsx)(x.Z,{})]});var b=r(3044);let Z=e=>{let n=(0,l.useRef)(null),r=(0,l.useCallback)(r=>{if(!r.target.files||r.target.files.length<1)return;let t=new FileReader,l=r.target.files[0];t.readAsDataURL(l),t.onload=()=>{if(t.result){let n=t.result;e.onLoadFile(n,l.name)}n&&n.current&&(n.current.value="")}},[e]);return{ref:n,onChange:r}},S=e=>{let{ref:n,onChange:r}=Z({onLoadFile:e.onLoadFile}),l=()=>{var e;null===(e=n.current)||void 0===e||e.click()};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.Z,{variant:"outlined",onClick:l,endIcon:(0,t.jsx)(b.Z,{}),children:"アップロード"}),(0,t.jsx)("input",{style:{display:"none"},type:"file",accept:".jpg,.jpeg,.png",onChange:r,ref:n})]})};var y=r(629),k=r(6693);let w=e=>{let{ref:n,onChange:r}=Z({onLoadFile:e.onLoadFile}),a=e=>{e.dataTransfer.types&&Array.from(e.dataTransfer.types).includes("Files")&&(e.dataTransfer.dropEffect="copy",e.preventDefault())},i=r=>{r.preventDefault();let t=r.dataTransfer,[l]=Array.from(t.files).filter(e=>e.type.includes("image/jpeg")||e.type.includes("image/png")),a=new FileReader;a.onload=()=>{if(a.result){let n=a.result;e.onLoadFile(n,l.name)}n&&n.current&&(n.current.value=""),n.current&&(n.current.value="")},a.readAsDataURL(l)},c=()=>{var e;null===(e=n.current)||void 0===e||e.click()};return(0,l.useEffect)(()=>{let e=e=>e.preventDefault(),n=e=>e.preventDefault();return document.addEventListener("dragover",e,!1),document.addEventListener("drop",n,!1),()=>{document.removeEventListener("dragover",e),document.removeEventListener("drop",n)}},[]),(0,t.jsxs)(y.Z,{variant:"outlined",onClick:c,onDrop:i,onDragOver:a,sx:{backgroundColor:"transparent",width:"100%",minHeight:"200px",display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center"},children:[(0,t.jsx)(k.Z,{}),(0,t.jsx)(g.Z,{variant:"h6",component:"div",children:"画像をドラッグ&ドロップでアップロード"}),(0,t.jsx)("input",{style:{display:"none"},type:"file",accept:".jpg,.jpeg,.png",onChange:r,ref:n})]})},O="(C) SQUARE ENIX CO., LTD. All Rights Reserved.",F={blur:!1},R=e=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j,{}),(0,t.jsxs)("main",{children:[(0,t.jsx)(C,{}),(0,t.jsx)(i.Z,{sx:{my:2},children:(0,t.jsxs)(c.Z,{children:[(0,t.jsxs)(s.Z,{children:[e.file&&(0,t.jsx)("img",{src:e.file,style:{maxWidth:"100%"}}),!e.file&&(0,t.jsx)(w,{onLoadFile:e.onLoadFile})]}),(0,t.jsxs)(o.Z,{sx:{pt:0,pl:2,pr:2,pb:2},children:[(0,t.jsx)(S,{onLoadFile:e.onLoadFile}),e.file&&(0,t.jsx)(a.Z,{variant:"contained",onClick:e.onEdit,endIcon:(0,t.jsx)(d.Z,{}),children:"編集"})]})]})}),(0,t.jsx)("footer",{style:{padding:"0 1em"},children:O})]})]});var A=r(2777),D=r(7954),B=r.n(D),L=r(7357),I=r(7720),E=r(1233),P=r(3946),W=r(724),U=r(3441),M=r(1703),T=r(44),N=r(7952),_=r(7361),z=r(2096),X=r(2440);function Y(e){let[n,r]=(0,l.useState)({right:"2em",bottom:"2em"}),[i,c]=(0,l.useState)(0),s=(0,l.useCallback)(e=>{let t={...n};switch(e){case"left":t.left="1em",delete t.right;break;case"right":t.right="1em",delete t.left;break;case"up":t.top="72px",delete t.bottom;break;case"down":t.bottom="1em",delete t.top}r(t)},[n]),o=(e,n)=>c(n);return(0,t.jsx)(L.Z,{sx:{...n,position:"absolute",minWidth:"400px"},children:(0,t.jsxs)(y.Z,{elevation:4,sx:{p:2,borderRadius:"16px"},children:[e.thumb,(0,t.jsxs)(E.Z,{spacing:2,divider:(0,t.jsx)(I.Z,{flexItem:!0}),children:[(0,t.jsxs)(E.Z,{spacing:1,children:[(0,t.jsxs)(E.Z,{direction:"row",spacing:1,children:[(0,t.jsx)(P.Z,{onClick:()=>s("left"),children:(0,t.jsx)(N.Z,{})}),(0,t.jsx)(P.Z,{onClick:()=>s("up"),children:(0,t.jsx)(_.Z,{})}),(0,t.jsx)(P.Z,{onClick:()=>s("down"),children:(0,t.jsx)(z.Z,{})}),(0,t.jsx)(P.Z,{onClick:()=>s("right"),children:(0,t.jsx)(X.Z,{})})]}),(0,t.jsxs)(E.Z,{direction:"row",spacing:1,children:[(0,t.jsx)(a.Z,{variant:"outlined",onClick:e.handleOnDownload,startIcon:(0,t.jsx)(U.Z,{}),children:"ダウンロード"}),(0,t.jsx)(a.Z,{variant:"outlined",onClick:e.handleOnCancel,startIcon:(0,t.jsx)(W.Z,{}),children:"戻る"})]})]}),(0,t.jsxs)(E.Z,{children:[(0,t.jsx)(L.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,t.jsxs)(M.Z,{value:i,onChange:o,"aria-label":"basic tabs example",children:[(0,t.jsx)(T.Z,{label:"表示",id:"menu-tab-0","aria-controls":"menu-tabpanel-0"}),(0,t.jsx)(T.Z,{label:"編集",id:"menu-tab-1","aria-controls":"menu-tabpanel-1"})]})}),(0,t.jsx)(L.Z,{hidden:0!==i,id:"menu-tabpanel-0","aria-labelledby":"menu-tab-0",sx:{pt:2,pr:1,pl:1},children:e.defaultPanel}),(0,t.jsx)(L.Z,{hidden:1!==i,id:"menu-tabpanel-1","aria-labelledby":"menu-tab-1",sx:{pt:2,pr:1,pl:1},children:e.editPanel})]}),(0,t.jsx)(E.Z,{children:(0,t.jsx)("footer",{style:{fontSize:"0.7em"},children:O})})]})]})})}var H=r(3473),V=r(9653),J=r(6178),G=r(6886),K=r(89),Q=r(6540),q=r(4895);function $(e){let n=(0,l.useMemo)(()=>e.value,[e.value]),r=(n,r)=>{if(r<e.min){e.handleSliderChange(e.min);return}if(r>e.max){e.handleSliderChange(e.max);return}e.handleSliderChange(r)},a=n=>{if(""===n.target.value){e.handleSliderChange(e.max);return}let r=Number(n.target.value);if(r<e.min){e.handleSliderChange(e.min);return}e.handleSliderChange(r)},i=()=>{e.value<e.min?e.handleSliderChange(e.min):e.value>e.max&&e.handleSliderChange(e.max)},c=()=>{let n=e.value+e.sliderStep>e.max?e.max:e.value+e.sliderStep;e.handleSliderChange(n)},s=()=>{let n=e.value-e.sliderStep<e.min?e.min:e.value-e.sliderStep;e.handleSliderChange(n)};return(0,t.jsxs)(G.ZP,{container:!0,children:[e.title&&(0,t.jsx)(G.ZP,{item:!0,xs:!0,children:(0,t.jsx)(g.Z,{id:e.title,children:e.title})}),(0,t.jsxs)(G.ZP,{item:!0,container:!0,spacing:2,alignItems:"center",children:[(0,t.jsx)(G.ZP,{item:!0,xs:!0,children:(0,t.jsxs)(E.Z,{spacing:1,direction:"row",sx:{mb:1},alignItems:"center",children:[(0,t.jsx)(q.Z,{onClick:s}),(0,t.jsx)(J.ZP,{disabled:e.disabled,value:n,min:e.min,max:e.max,step:e.sliderStep||1,valueLabelDisplay:"auto",onChange:r,"aria-labelledby":"input-slider"}),(0,t.jsx)(Q.Z,{onClick:c})]})}),(0,t.jsx)(G.ZP,{item:!0,children:(0,t.jsx)(K.Z,{disabled:e.disabled,value:n,size:"small",onChange:a,onBlur:i,inputProps:{step:e.step,min:e.min,max:e.max,type:"number","aria-labelledby":e.title}})})]})]})}var ee=r(4480);let en=(0,ee.cn)({key:"editState",default:{scale:100,rotate:0,copyrightFontSize:15,copyrightColor:"#FFFFFF",shape:[],shapeColor:"#000000",shapeOpacity:1,blur:[],cropFlag:!1,cropState:"none",copyrightFlag:!1}}),er=()=>(0,ee.sJ)(en),et=()=>{let e=(0,ee.Zl)(en),n=n=>r=>{e(e=>({...e,[n]:[...e[n],r]}))},r=n=>r=>{e(e=>({...e,[n]:[...e[n].slice(0,r),...e[n].slice(r+1)]}))};return{setScale:n=>e(e=>({...e,scale:n})),setRotate:n=>e(e=>({...e,rotate:n})),setCopyrightFontSize:n=>e(e=>({...e,copyrightFontSize:n})),setCopyrightColor:n=>e(e=>({...e,copyrightColor:n})),addBlur:n("blur"),removeBlur:r("blur"),addShape:n("shape"),removeShape:r("shape"),setShapeColor:n=>e(e=>({...e,shapeColor:n})),setShapeOpacity:n=>e(e=>({...e,shapeOpacity:n})),cropStart:()=>{let n="start";return e(e=>({...e,cropFlag:!0,cropState:n})),{cropFlag:!0,cropState:n}},cropDone:()=>(e(e=>({...e,cropFlag:!0,cropState:"done"})),{cropFlag:!0,cropState:"done"}),cropRemove:n=>e(e=>e.cropFlag?(n({state:"none",cropFlag:!1}),{...e,cropFlag:!1,cropState:"none"}):e),copyrightOn:()=>e(e=>({...e,copyrightFlag:!0})),copyrightOff:()=>e(e=>({...e,copyrightFlag:!1}))}},el=e=>{let n=(0,l.useRef)(B()(n=>{e.onChange&&e.onChange(n)},100)),r=(0,l.useCallback)(e=>{n.current(e.currentTarget.value)},[]);return(0,t.jsx)(K.Z,{disabled:e.disabled,type:"color",sx:{width:"2em",minWidth:"32px"},value:e.value,onChange:r})},ea=e=>{let{scale:n,rotate:r,copyrightColor:a,copyrightFontSize:i,copyrightFlag:c}=er(),{setScale:s,setRotate:o,setCopyrightFontSize:d,setCopyrightColor:u,copyrightOn:h,copyrightOff:p,cropRemove:x}=et(),g=(0,l.useCallback)(n=>{s(n),e.onChangeScale(n)},[e,s]),v=(0,l.useCallback)(n=>{o(n),e.onChangeRotate(n),x(e.onChangeCrop)},[x,e,o]),f=(0,l.useCallback)((n,r)=>{r?h():p(),e.onChangeCopyright(r)},[p,h,e]),m=(0,l.useCallback)(n=>{d(n),e.onChangeCopyrightFontSize(n)},[e,d]),j=(0,l.useCallback)(n=>{u(n),e.onChangeCopyrightColor(n)},[e,u]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($,{title:"拡大/縮小",value:n,min:1,max:100,sliderStep:10,step:1,handleSliderChange:g}),(0,t.jsx)($,{title:"回転",value:r,min:-180,max:180,sliderStep:15,step:1,handleSliderChange:v}),(0,t.jsxs)(L.Z,{children:[(0,t.jsxs)(E.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,t.jsx)(H.Z,{}),(0,t.jsx)(V.Z,{onChange:f}),(0,t.jsx)(el,{disabled:!c,value:a,onChange:j})]}),(0,t.jsx)($,{disabled:!c,value:i,min:0,max:50,sliderStep:1,step:1,handleSliderChange:m})]})]})};var ei=r(1048),ec=r(55),es=r(1733),eo=r(8462),ed=r(7212),eu=r(8619),eh=r(4842);let ep=()=>{let e=window.crypto.randomUUID?window.crypto.randomUUID():"".concat(Math.random()*Number.MAX_VALUE);return e},ex=e=>{let{blur:n}=er(),{addBlur:r,removeBlur:a}=et(),i=(0,l.useCallback)(()=>{let n=ep();r(n),e.handleOnBlur(n)},[r,e]),c=(0,l.useCallback)((n,r)=>{a(r),e.handleOnDeleteBlur(n,r)},[e,a]);return(0,t.jsx)(E.Z,{direction:"row",spacing:1,children:(0,t.jsxs)(eo.Z,{children:[(0,t.jsx)(eu.Z,{children:(0,t.jsx)(eh.Z,{primary:"ぼかし追加",onClick:i})}),n.map((n,r)=>(0,t.jsx)(ed.ZP,{dense:!0,secondaryAction:(0,t.jsx)(P.Z,{color:"primary",component:"span",onClick:()=>c(n,r),children:(0,t.jsx)(es.Z,{})}),children:(0,t.jsx)(eu.Z,{onClick:()=>e.handleOnSelectBlur(n),children:(0,t.jsx)(eh.Z,{primary:"ぼかし ".concat(r+1)})})},n))]})})},eg=e=>{let{shape:n,shapeColor:r,shapeOpacity:i}=er(),{addShape:c,removeShape:s,setShapeColor:o,setShapeOpacity:d}=et(),u=(0,l.useCallback)(()=>{let n=ep();c(n),e.handleOnAddShape(n,r)},[c,e,r]),h=(0,l.useCallback)(n=>{o(n),e.handleOnChangeColorShape(n)},[e,o]),p=(0,l.useCallback)((n,r)=>{s(r),e.handleOnDeleteShape(n,r)},[e,s]),x=(0,l.useCallback)(n=>{d(n),e.handleOnChangeOpacityShape(n)},[e,d]);return(0,t.jsxs)(E.Z,{direction:"column",spacing:1,children:[(0,t.jsxs)(E.Z,{direction:"row",spacing:2,children:[(0,t.jsx)(a.Z,{variant:"outlined",onClick:u,children:"四角"}),(0,t.jsx)(el,{disabled:!1,value:r,onChange:h}),(0,t.jsx)($,{value:i,min:.1,max:1,sliderStep:.1,step:.1,handleSliderChange:x})]}),n.length>0&&(0,t.jsx)(eo.Z,{dense:!0,children:n.map((n,r)=>(0,t.jsx)(ed.ZP,{secondaryAction:(0,t.jsx)(P.Z,{color:"primary",component:"span",onClick:()=>p(n,r),children:(0,t.jsx)(es.Z,{})}),children:(0,t.jsx)(eu.Z,{onClick:()=>e.handleOnSelectShape(n),children:(0,t.jsx)(eh.Z,{primary:"".concat(r+1)})})},n))})]})};function ev(e){let{cropState:n}=er(),{cropStart:r,cropDone:i,cropRemove:c}=et(),s=(0,l.useCallback)(()=>{let n=r();e.handleOnCrop({state:n.cropState,cropFlag:n.cropFlag})},[r,e]),o=(0,l.useCallback)(()=>{let n=i();e.handleOnCrop({state:n.cropState,cropFlag:n.cropFlag})},[i,e]),d=(0,l.useCallback)(()=>{c(e.handleOnCrop)},[c,e.handleOnCrop]);return(0,t.jsxs)(E.Z,{spacing:1,divider:(0,t.jsx)(I.Z,{flexItem:!0}),children:[F.blur&&(0,t.jsx)(ex,{handleOnBlur:e.handleOnBlur,handleOnSelectBlur:e.handleOnSelectBlur,handleOnDeleteBlur:e.handleOnDeleteBlur}),(0,t.jsx)(eg,{handleOnAddShape:e.handleOnShape,handleOnChangeColorShape:e.handleOnChangeColorShape,handleOnChangeOpacityShape:e.handleOnChangeOpacityShape,handleOnSelectShape:e.handleOnSelectShape,handleOnDeleteShape:e.handleOnDeleteShape}),(0,t.jsxs)(E.Z,{direction:"row",spacing:1,children:[(0,t.jsx)(a.Z,{variant:"outlined",onClick:s,startIcon:(0,t.jsx)(ei.Z,{}),children:"切り抜く"}),"start"===n&&(0,t.jsx)(P.Z,{color:"primary","aria-label":"crop start",component:"span",onClick:o,children:(0,t.jsx)(ec.Z,{})}),"start"===n&&(0,t.jsx)(P.Z,{color:"primary","aria-label":"crop end",component:"span",onClick:d,children:(0,t.jsx)(es.Z,{})})]})]})}var ef=r(657),em=r(7645),ej=r(1425),eC=r(6514),eb=r(3841),eZ=r(431),eS=r(4054),ey=r(7068);let ek=e=>Math.round(10*e)/10,ew=e=>{let[n,r]=(0,l.useState)("png"),[i,c]=(0,l.useState)(null),[s,o]=(0,l.useState)(0),[d,u]=(0,l.useState)(1),[h,p]=(0,l.useState)(""),x=(0,l.useRef)(null),v=(0,l.useMemo)(()=>e.fileName.slice(0,e.fileName.lastIndexOf(".")),[e.fileName]),f=(0,l.useMemo)(()=>s>=1e9?"".concat(ek(s/1e3/1e3/1e3),"GB"):s>=1e6?"".concat(ek(s/1e3/1e3),"MB"):s>=1e3?"".concat(ek(s/1e3),"KB"):"".concat(ek(s),"B"),[s]),m=(0,l.useCallback)((e,n)=>{if(!e)return;let r=e=>{var n;c(e),o(null!==(n=null==e?void 0:e.size)&&void 0!==n?n:0)};if("jpeg"===n){e.toBlob(r,"image/".concat(n),d);return}e.toBlob(r,"image/".concat(n))},[d]);(0,l.useEffect)(()=>{e.canvas&&(p(e.canvas.toDataURL()),m(e.canvas,n))},[e.canvas,m,n]);let j=(0,l.useCallback)(()=>{e.onClose()},[e]),C=n=>{let t=n.target.value;r(t),m(e.canvas,t)},b=(0,l.useCallback)(r=>{u(r),m(e.canvas,n)},[e.canvas,m,n]),Z=(0,l.useCallback)(()=>{if(!i)return;let e=document.createElement("a");e.download="".concat(v,".").concat(n),e.href=URL.createObjectURL(i),document.body.appendChild(e),e.click(),document.body.removeChild(e)},[i,v,n]);return(0,t.jsxs)(ef.Z,{open:e.open,onClose:j,PaperProps:{sx:{maxWidth:"80vw",borderRadius:"16px"}},children:[(0,t.jsxs)(em.Z,{children:[v,".",n]}),(0,t.jsx)(eC.Z,{dividers:!0,children:(0,t.jsxs)(E.Z,{spacing:2,children:[(0,t.jsx)("img",{ref:x,src:h,style:{maxWidth:"100%"}}),(0,t.jsxs)(G.ZP,{container:!0,spacing:2,width:"100%",children:[(0,t.jsx)(G.ZP,{item:!0,xs:2,pl:0,children:(0,t.jsx)(y.Z,{variant:"outlined",sx:{backgroundColor:"transparent",width:"100%",height:"100%",display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center"},children:(0,t.jsx)(g.Z,{variant:"h5",component:"div",children:f})})}),(0,t.jsx)(G.ZP,{item:!0,xs:10,children:(0,t.jsxs)(E.Z,{spacing:1,children:[(0,t.jsxs)(eS.Z,{fullWidth:!0,children:[(0,t.jsx)(eb.Z,{id:"download-file-ext",children:"ファイルの種類"}),(0,t.jsxs)(ey.Z,{labelId:"download-file-ext",id:"download-file-select",value:n,label:"type",onChange:C,children:[(0,t.jsx)(eZ.Z,{value:"png",children:"png"}),(0,t.jsx)(eZ.Z,{value:"jpeg",children:"jpeg"})]})]}),"jpeg"===n&&(0,t.jsx)($,{title:"保存品質",value:d,handleSliderChange:b,max:1,min:.01,sliderStep:.1,step:.01})]})})]})]})}),(0,t.jsxs)(ej.Z,{children:[(0,t.jsx)(a.Z,{variant:"outlined",onClick:()=>Z(),startIcon:(0,t.jsx)(U.Z,{}),children:"ダウンロード"}),(0,t.jsx)(a.Z,{variant:"text",onClick:j,children:"キャンセル"})]})]})},eO=(0,ee.cn)({key:"editUIState",default:{openModalFlag:!1}}),eF=()=>(0,ee.sJ)(eO),eR=()=>{let e=(0,ee.Zl)(eO);return{openModal:()=>e(e=>({...e,openModalFlag:!0})),closeModal:()=>e(e=>({...e,openModalFlag:!1}))}},eA=e=>{let[n,r]=(0,l.useState)(""),[a,i]=(0,l.useState)(0),[c,s]=(0,l.useState)(0),o=(0,l.useRef)(B()(e=>{e&&r(e.toDataURL("image/jpeg"))},100)),d=(0,l.useCallback)(e=>{i(e.currentTarget.naturalWidth),s(e.currentTarget.naturalHeight)},[]);return(0,l.useEffect)(()=>{o.current(e.canvas)},[e.canvas]),(0,t.jsxs)(E.Z,{spacing:1,children:[(0,t.jsx)(L.Z,{component:"div",children:(0,t.jsx)("img",{src:n,style:{maxWidth:"400px",maxHeight:"200px"},onLoad:d})}),(0,t.jsxs)(g.Z,{variant:"caption",children:[a," x ",c]})]})};var eD=r(3096),eB=r.n(eD);let eL=()=>{let{scale:e,cropFlag:n}=er(),r=(0,l.useRef)({scale:e,cropFlag:n});return(0,l.useEffect)(()=>{r.current={scale:e,cropFlag:n}},[e,n]),{scaleAndCropRef:r}},eI=()=>{let e=(e,n)=>{var r,t,l;let a=e.getZoom();e.setZoom(1);let i=null!==(t=e.width)&&void 0!==t?t:100,c=null!==(l=e.height)&&void 0!==l?l:100,s=e.toCanvasElement(1,{width:2*i,height:2*c,left:-i/2,top:-c/2}),o=new A.fabric.Image(s,{width:i/2,height:c/2,cropX:i/2,cropY:c/2,cornerStyle:"circle",strokeWidth:1,strokeUniform:!0,objectCaching:!1,visible:!0,backgroundColor:"rgba(255, 255, 255, 0.05)"});o.id=n,o.setControlsVisibility({mtr:!1});let d=new A.fabric.Image.filters.Blur({blur:.2});return null===(r=o.filters)||void 0===r||r.push(d),o.applyFilters(),e.add(o),e.setActiveObject(o),e.setZoom(100/a),e.renderAll(),o},n=(0,l.useRef)(eB()((e,n)=>{var r,t,l,a,i,c,s,o;let d=null!==(r=e.width)&&void 0!==r?r:100,u=null!==(t=e.height)&&void 0!==t?t:100,h=null!==(l=n.scaleX)&&void 0!==l?l:1,p=null!==(a=n.scaleY)&&void 0!==a?a:1,x=null!==(i=n.top)&&void 0!==i?i:0,g=null!==(c=n.left)&&void 0!==c?c:0,v=null!==(s=n.width)&&void 0!==s?s:1,f=null!==(o=n.height)&&void 0!==o?o:1;n.cropX=(g+d/2)*h,n.cropY=(x+u/2)*p,n.width=v*h,n.height=f*p,n.scaleX=1,n.scaleY=1,e.renderAll()},10));return{createBlur:e,moveBlur:n.current}};A.fabric.textureSize=8192;let eE={left:0,top:0,fill:"#FFFFFF",fontSize:15,selectable:!1,hasControls:!1,visible:!1};function eP(e){let{scaleAndCropRef:n}=eL(),{openModalFlag:r}=eF(),{openModal:a,closeModal:c}=eR(),{createBlur:s,moveBlur:o}=eI(),d=(0,l.useRef)(),u=(0,l.useRef)(),h=(0,l.useRef)(),p=(0,l.useRef)(),x=(0,l.useRef)(),g=(0,l.useRef)(null),[v,f]=(0,l.useState)(),m=(0,l.useRef)(B()(()=>{var e,r,t,l,a,i,c,s,o,u,p;if(!d.current)return;let{scale:x,cropFlag:g}=n.current;null===(e=d.current)||void 0===e||e.setZoom(1);let v={format:"png",left:0,top:0,width:(null!==(t=d.current.width)&&void 0!==t?t:1)*100/x,height:(null!==(l=d.current.height)&&void 0!==l?l:1)*100/x};if(h.current&&g){h.current.set({opacity:0}).setCoords();let e=null!==(a=h.current.scaleX)&&void 0!==a?a:1,n=null!==(i=h.current.scaleY)&&void 0!==i?i:1;v.left=null!==(c=h.current.left)&&void 0!==c?c:0,v.top=null!==(s=h.current.top)&&void 0!==s?s:0,v.width=(null!==(o=h.current.width)&&void 0!==o?o:1)*e,v.height=(null!==(u=h.current.height)&&void 0!==u?u:1)*n}f(d.current.toCanvasElement(1,v)),h.current&&g&&(null===(p=h.current)||void 0===p||p.set({opacity:1}).setCoords()),null===(r=d.current)||void 0===r||r.setZoom(x/100)},100)),b=e=>{var n,r;if(!p.current)return;null===(n=d.current)||void 0===n||n.setZoom(e/100);let t=p.current.setCoords().getBoundingRect();null===(r=d.current)||void 0===r||r.setDimensions({width:t.width,height:t.height}),u.current&&u.current.set({top:0,left:0,width:t.width/e*100,height:t.height/e*100}).setCoords(),p.current.viewportCenter().setCoords()},Z=e=>{b(e)},S=(0,l.useRef)(B()(e=>{var r;p.current&&p.current.rotate(e),b(n.current.scale),null===(r=d.current)||void 0===r||r.renderAll(),m.current()},200)),y=e=>S.current(e),k=()=>{var e,n,r;if(h.current){if(h.current.set({visible:!1,top:0,left:0,scaleX:1,scaleY:1}),null===(e=u.current)||void 0===e?void 0:e.width){let e=.8*u.current.width;h.current.left=(u.current.width-e)/2,h.current.width=e}if(null===(n=u.current)||void 0===n?void 0:n.height){let e=.8*u.current.height;h.current.top=(u.current.height-e)/2,h.current.height=e}h.current.setCoords(),null===(r=d.current)||void 0===r||r.discardActiveObject()}},w=e=>{var n,r,t;if(h.current){if("start"===e.state){h.current.strokeWidth=0,h.current.fill="rgba(0, 0, 0, 0.5)",h.current.selectable=!0,h.current.visible=!0,h.current.bringToFront(),null===(r=d.current)||void 0===r||r.setActiveObject(h.current);return}h.current.selectable=!1,"none"===e.state&&k(),"done"===e.state&&(h.current.fill="rgba(0, 0, 0, 0)",h.current.strokeWidth=1,h.current.bringToFront(),null===(t=d.current)||void 0===t||t.discardActiveObject()),m.current(),null===(n=d.current)||void 0===n||n.renderAll()}},F=e=>{var n;x.current&&(x.current.set({fontSize:e}).setCoords(),null===(n=d.current)||void 0===n||n.renderAll(),m.current())},R=e=>{var n;x.current&&(x.current.set({fill:e}).setCoords(),null===(n=d.current)||void 0===n||n.renderAll(),m.current())},D=e=>{var r,t,l,a,i,c,s,o;if(x.current){if(!e){x.current.set({selectable:!1,visible:!1}),null===(l=d.current)||void 0===l||l.discardActiveObject(),null===(a=d.current)||void 0===a||a.renderAll(),m.current();return}x.current.set({...eE,selectable:!0,visible:!0}),n.current.cropFlag&&x.current.set({left:Math.max(null!==(s=null===(i=h.current)||void 0===i?void 0:i.left)&&void 0!==s?s:0,0),top:Math.max(null!==(o=null===(c=h.current)||void 0===c?void 0:c.top)&&void 0!==o?o:0,0)}),x.current.setCoords(),x.current.bringToFront(),null===(r=d.current)||void 0===r||r.setActiveObject(x.current),null===(t=d.current)||void 0===t||t.renderAll(),m.current()}},I=e=>{if(!e||d.current)return;let n=new A.fabric.Canvas(e,{isDrawingMode:!1,backgroundColor:"rgba(255, 255, 255, 0.05)"});n.setDimensions({width:"400",height:"400"});let r=new A.fabric.Text(O,{...eE});r.on("moving",()=>{m.current()}),n.add(r),x.current=r;let t=new A.fabric.Rect({fill:"none",width:20,height:20,evented:!1,selectable:!1});u.current=t,n.add(t);let l=new A.fabric.Rect({fill:"rgba(0, 0, 0, 0)",width:20,height:20,cornerStyle:"circle",stroke:"red",strokeWidth:1,strokeUniform:!0,visible:!1});l.setControlsVisibility({mtr:!1}),n.add(l),h.current=l,d.current=n},E=()=>{if(!g.current||!d||!d.current)return;let e=new A.fabric.Image(g.current,{top:0,left:0,centeredRotation:!0,selectable:!1});p.current=e,d.current.add(e),b(n.current.scale),h.current&&k(),m.current(),d.current.renderAll()};(0,l.useEffect)(()=>{g.current&&(g.current.src=e.file)},[e.file]);let P=()=>{m.current(),a()},W=e=>{if(!d.current)return;let n=s(d.current,e);m.current(),n.on("moving",()=>{d.current&&o(d.current,n)}),n.on("scaling",()=>{d.current&&o(d.current,n)})},U=e=>{if(d.current){for(let n of d.current.getObjects())if(n.id===e){d.current.setActiveObject(n),d.current.renderAll();break}}},M=e=>{if(d.current){for(let n of d.current.getObjects())if(n.id===e){d.current.remove(n),m.current();break}}},T=(e,n)=>{if(!d.current)return;let r=new A.fabric.Rect({fill:n,width:d.current.getWidth()/4,height:d.current.getHeight()/4,cornerStyle:"circle",strokeUniform:!0});r.id=e,r.bringToFront(),r.viewportCenter().setCoords(),d.current.add(r),d.current.renderAll(),m.current()},N=e=>{var n;if(d.current){for(let n of d.current.getActiveObjects())n.set({fill:e}).setCoords();null===(n=d.current)||void 0===n||n.renderAll()}},_=e=>{var n;if(d.current){for(let n of d.current.getActiveObjects())n.set({opacity:e}).setCoords();null===(n=d.current)||void 0===n||n.renderAll()}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j,{}),(0,t.jsxs)("main",{children:[(0,t.jsx)(C,{}),(0,t.jsx)(i.Z,{sx:{my:2},maxWidth:!1,children:(0,t.jsx)("div",{style:{overflow:"auto",maxWidth:"100%",maxHeight:"100vh"},children:(0,t.jsxs)(L.Z,{children:[(0,t.jsx)("img",{ref:g,style:{display:"none"},onLoad:E}),(0,t.jsx)("canvas",{id:"c",ref:I})]})})}),(0,t.jsx)(Y,{thumb:(0,t.jsx)(eA,{canvas:v}),defaultPanel:(0,t.jsx)(ea,{onChangeScale:Z,onChangeRotate:y,onChangeCopyright:D,onChangeCopyrightFontSize:F,onChangeCopyrightColor:R,onChangeCrop:w}),editPanel:(0,t.jsx)(ev,{handleOnCrop:w,handleOnBlur:W,handleOnSelectBlur:U,handleOnDeleteBlur:M,handleOnShape:T,handleOnChangeColorShape:N,handleOnChangeOpacityShape:_,handleOnSelectShape:U,handleOnDeleteShape:M}),handleOnCancel:e.onBack,handleOnDownload:P}),(0,t.jsx)(ew,{open:r,onClose:()=>c(),canvas:v,fileName:e.fileName})]})]})}let eW=()=>{let[e,n]=(0,l.useState)(""),[r,a]=(0,l.useState)(void 0),[i,c]=(0,l.useState)(!1),s=(0,l.useCallback)((e,r)=>{a(e),n(r),c(!0)},[]),o=(0,l.useCallback)(()=>{c(!0)},[]),d=(0,l.useCallback)(()=>{c(!1)},[]);return(0,t.jsxs)(t.Fragment,{children:[i&&r&&(0,t.jsx)(eP,{file:r,fileName:e,onBack:d}),!i&&(0,t.jsx)(R,{file:r,onLoadFile:s,onEdit:o})]})},eU=()=>(0,t.jsx)(eW,{});var eM=eU},4960:function(){},6759:function(){},6272:function(){}},function(e){e.O(0,[498,769,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);